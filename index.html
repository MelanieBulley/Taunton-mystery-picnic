
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Taunton Mystery Picnic Walk</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #020617;
      --bg-soft: #020617;
      --card: #020617;
      --accent: #f97316;
      --accent-soft: rgba(249, 115, 22, 0.12);
      --accent-strong: rgba(249,115,22,0.35);
      --text: #e5e7eb;
      --muted: #9ca3af;
      --border: #1f2937;
      --shadow-soft: 0 22px 45px rgba(0,0,0,0.7);
      --radius-xl: 18px;
      --error: #f97373;
      --success: #4ade80;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #111827, #020617 55%);
      color: var(--text);
      line-height: 1.6;
    }

    header {
      padding: 1.5rem clamp(1.5rem, 4vw, 3.5rem);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 20;
      backdrop-filter: blur(18px);
      background: linear-gradient(
        to bottom,
        rgba(15,23,42,0.96),
        rgba(15,23,42,0.8),
        transparent
      );
    }

    header .title {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: baseline;
      gap: 0.5rem;
    }

    header h1 {
      margin: 0;
      font-size: clamp(1.35rem, 3vw, 1.9rem);
      letter-spacing: 0.04em;
    }

    header .tagline {
      font-size: 0.9rem;
      color: var(--muted);
    }

    main {
      max-width: 960px;
      margin: 0 auto;
      padding: 1.5rem clamp(1.5rem, 4vw, 3.5rem) 3rem;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      padding: 0.25rem 0.7rem;
      border-radius: 999px;
      border: 1px solid rgba(249,115,22,0.4);
      background: rgba(15,23,42,0.9);
      color: var(--muted);
    }

    .pill span {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 8px rgba(249,115,22,0.75);
    }

    .card {
      margin-top: 1.5rem;
      padding: 1.6rem 1.6rem 1.8rem;
      border-radius: var(--radius-xl);
      background: radial-gradient(circle at top left,
        rgba(249,115,22,0.18),
        transparent 60%
      ), radial-gradient(circle at bottom right,
        rgba(56,189,248,0.14),
        transparent 60%
      ), var(--card);
      border: 1px solid rgba(148,163,184,0.32);
      box-shadow: var(--shadow-soft);
    }

    .intro-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.7fr) minmax(0, 1.3fr);
      gap: 1.2rem;
    }

    .card h2 {
      margin-top: 0;
      margin-bottom: 0.4rem;
      font-size: 1.25rem;
    }

    .bubble {
      padding: 0.9rem 1rem;
      border-radius: 16px;
      background: rgba(15,23,42,0.98);
      border: 1px solid rgba(148,163,184,0.45);
      font-size: 0.92rem;
      color: var(--muted);
      margin-top: 0.45rem;
    }

    .bubble strong {
      color: var(--text);
    }

    .funfacts {
      font-size: 0.92rem;
      color: var(--muted);
      padding-left: 1rem;
    }

    .funfacts li {
      margin-bottom: 0.35rem;
    }

    .btn-row {
      margin-top: 1.3rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      align-items: center;
    }

    button {
      border-radius: 999px;
      border: 1px solid transparent;
      padding: 0.6rem 1.3rem;
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      transition: transform 0.08s ease-out, box-shadow 0.08s ease-out,
        background 0.1s ease-out, border 0.1s ease-out;
      background: var(--accent);
      color: #111827;
      box-shadow: 0 14px 28px rgba(249,115,22,0.35);
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 18px 38px rgba(249,115,22,0.45);
    }

    button.secondary {
      background: transparent;
      color: var(--muted);
      border-color: rgba(148,163,184,0.65);
      box-shadow: none;
    }

    button.secondary:hover {
      border-color: rgba(249,115,22,0.8);
      color: var(--accent);
    }

    button.small {
      padding: 0.45rem 1rem;
      font-size: 0.85rem;
    }

    .hidden {
      display: none !important;
    }

    .stage-label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--muted);
      margin-bottom: 0.25rem;
    }

    .stop-title {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 0.6rem;
      align-items: baseline;
    }

    .stop-title h2 {
      margin: 0;
      font-size: 1.1rem;
    }

    .stop-meta {
      font-size: 0.78rem;
      color: var(--muted);
      text-align: right;
    }

    .stop-meta span.tag {
      display: inline-block;
      padding: 0.1rem 0.6rem;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.45);
      margin-left: 0.25rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-size: 0.7rem;
    }

    .stop-meta span.tag.highlight {
      border-color: var(--accent-strong);
      color: var(--accent);
    }

    .grid-two {
      display: grid;
      grid-template-columns: minmax(0, 1.5fr) minmax(0, 1.5fr);
      gap: 1.2rem;
      margin-top: 1rem;
      font-size: 0.94rem;
    }

    .panel {
      padding: 0.9rem 1rem;
      border-radius: 14px;
      background: rgba(15,23,42,0.96);
      border: 1px solid rgba(55,65,81,0.85);
      color: var(--muted);
      font-size: 0.9rem;
    }

    .panel h3 {
      margin-top: 0;
      margin-bottom: 0.35rem;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--muted);
    }

    .panel.history {
      border-color: rgba(56,189,248,0.65);
    }

    .panel.directions {
      border-color: rgba(132,204,22,0.7);
    }

    .panel.hint {
      border-color: rgba(249,115,22,0.7);
      background: rgba(15,23,42,0.98);
    }

    .panel.result {
      border-color: rgba(96,165,250,0.7);
    }

    code {
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco,
        Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.86rem;
      padding: 0.06rem 0.25rem;
      border-radius: 4px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(55,65,81,0.8);
      color: #e5e7eb;
    }

    .input-row {
      margin-top: 0.9rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
      align-items: center;
    }

    input[type="text"] {
      flex: 1 1 180px;
      min-width: 0;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      padding: 0.55rem 0.9rem;
      background: rgba(15,23,42,0.9);
      color: var(--text);
      font-size: 0.95rem;
      outline: none;
    }

    input[type="text"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(249,115,22,0.55);
    }

    .small-text {
      font-size: 0.8rem;
      color: var(--muted);
      margin-top: 0.4rem;
    }

    .status {
      margin-top: 0.5rem;
      font-size: 0.85rem;
    }

    .status.ok {
      color: var(--success);
    }

    .status.err {
      color: var(--error);
    }

    .final-message {
      text-align: center;
    }

    .final-message h2 {
      margin-top: 0;
      font-size: 1.35rem;
    }

    footer {
      margin-top: 2.5rem;
      padding-top: 1.4rem;
      border-top: 1px solid var(--border);
      font-size: 0.78rem;
      color: var(--muted);
      text-align: center;
    }

    @media (max-width: 800px) {
      .intro-layout,
      .grid-two {
        grid-template-columns: minmax(0, 1fr);
      }
      .stop-meta {
        text-align: left;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="title">
      <div>
        <div class="pill"><span></span> Taunton ¬∑ Mystery Picnic Walk</div>
        <h1>Taunton Mystery Picnic ¬∑ 1-Mile Puzzle Walk</h1>
      </div>
      <div class="tagline">
        Start at the castle ¬∑ Solve puzzles ¬∑ Unlock history ¬∑ Picnic in Vivary Park
      </div>
    </div>
  </header>

  <main>
    <!-- INTRO SCREEN -->
    <section id="intro-screen" class="card">
      <div class="stage-label">Welcome</div>
      <h2>Welcome to your Taunton Mystery Picnic</h2>
      <p>
        This is a self-guided, roughly <strong>1-mile</strong> walking tour around
        Taunton town centre. You‚Äôll solve puzzles, unlock snippets of history, and
        collect ideas for a perfect picnic in <strong>Vivary Park</strong>.
      </p>

      <div class="intro-layout">
        <div>
          <h3>Taunton in a Nutshell</h3>
          <div class="bubble">
            <p>
              Taunton has grown up around the <strong>River Tone</strong> and a
              <strong>medieval castle</strong>. It became an important market town
              for wool, cloth and later dairy, and played a dramatic role in the
              <strong>Monmouth Rebellion</strong> of 1685 when rebels tried to
              unseat King James II.
            </p>
            <p>
              Today, Taunton blends historic lanes, independent shops and green
              spaces right in the centre of town ‚Äì ideal for a gentle mystery walk.
            </p>
          </div>
        </div>
        <div>
          <h3>Fun Facts</h3>
          <ul class="funfacts">
            <li>
              The name <strong>Taunton</strong> likely comes from
              ‚Äú<em>Town on the Tone</em>‚Äù, referencing the river that runs through it.
            </li>
            <li>
              The castle site has seen fortifications since at least the
              <strong>1100s</strong>, and has hosted royal visits, uprisings and
              court sessions.
            </li>
            <li>
              <strong>Vivary Park</strong> takes its name from a medieval ‚Äúvivary‚Äù ‚Äì
              a place where fish were kept to feed local people.
            </li>
            <li>
              Taunton was once famous for its cloth and later cider ‚Äì and the county
              of Somerset is still strongly associated with apples and dairy.
            </li>
          </ul>
        </div>
      </div>

      <div class="btn-row">
        <button id="start-btn">
          ‚ñ∂ Start the mystery walk
        </button>
        <button class="secondary small" onclick="document.getElementById('how-it-works').scrollIntoView({behavior:'smooth'})">
          How it works
        </button>
      </div>
    </section>

    <section id="how-it-works" class="card">
      <h2>How it works</h2>
      <div class="bubble">
        <ol>
          <li>
            You‚Äôll see a <strong>puzzle page</strong> for each stop: a riddle,
            cipher or word puzzle that hints at the next location.
          </li>
          <li>
            You can tap <strong>‚ÄúShow hint‚Äù</strong> on any page to get guidance on
            how to approach the puzzle.
          </li>
          <li>
            Type your answer into the box and hit <strong>‚ÄúCheck answer‚Äù</strong>.
            If you‚Äôre right, you‚Äôll reveal:
            <ul>
              <li>Details of the stop</li>
              <li>History &amp; fun facts (like an audio tour in text form)</li>
              <li>Walking directions to that stop</li>
            </ul>
          </li>
          <li>
            Stuck? Press <strong>‚ÄúI give up ‚Äì show me‚Äù</strong> to reveal the answer
            and still get the history and directions.
          </li>
        </ol>
        <p>
          The puzzles are designed to be <strong>moderately challenging</strong> but
          solvable ‚Äì they often point to a <em>word or idea</em> linked to the next
          place, not always the exact name.
        </p>
      </div>
    </section>

    <!-- GAME SCREEN -->
    <section id="game-screen" class="card hidden">
      <div class="stage-label" id="stage-label">Stop</div>
      <div class="stop-title">
        <h2 id="stop-name">Stop name</h2>
        <div class="stop-meta">
          <span id="stop-distance"></span><br />
          <span id="stop-tags"></span>
        </div>
      </div>

      <div class="grid-two">
        <div>
          <div class="panel">
            <h3>Puzzle clue</h3>
            <p id="puzzle-text"></p>

            <div id="puzzle-extra"></div>

            <div class="input-row">
              <input
                type="text"
                id="answer-input"
                placeholder="Type your answer here..."
                autocomplete="off"
              />
              <button class="small" id="check-answer-btn">Check answer</button>
            </div>
            <div class="small-text">
              Answers are usually a single word or short phrase, not case-sensitive.
            </div>

            <div class="btn-row" style="margin-top:0.75rem;">
              <button class="secondary small" id="hint-toggle-btn">
                üí° Show hint
              </button>
              <button class="secondary small" id="give-up-btn">
                üôà I give up ‚Äì show me
              </button>
            </div>

            <div id="status-msg" class="status"></div>
          </div>

          <div id="hint-panel" class="panel hint hidden">
            <h3>Hint</h3>
            <p id="hint-text"></p>
          </div>
        </div>

        <div>
          <div id="result-panel" class="panel result hidden">
            <h3>Stop details unlocked</h3>
            <p id="answer-explanation"></p>
            <div id="history-block" class="panel history" style="margin-top:0.7rem;">
              <h3>History &amp; fun facts</h3>
              <div id="history-text"></div>
            </div>
            <div id="directions-block" class="panel directions" style="margin-top:0.7rem;">
              <h3>Walking directions</h3>
              <div id="directions-text"></div>
            </div>
            <div class="panel" style="margin-top:0.7rem;" id="picnic-block">
              <h3>Picnic idea</h3>
              <div id="picnic-text"></div>
            </div>

            <div class="btn-row">
              <button class="small" id="next-stop-btn">
                ‚ûú Go to next puzzle
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- FINAL SCREEN -->
    <section id="final-screen" class="card hidden">
      <div class="final-message">
        <div class="stage-label">Finish</div>
        <h2>You made it to Vivary Park!</h2>
        <p>
          Well done ‚Äì you‚Äôve walked roughly a mile through Taunton‚Äôs centre, solved
          ciphers and riddles, and followed in the footsteps of centuries of local
          traders, rebels and residents.
        </p>
        <div class="bubble">
          <p>
            <strong>Vivary Park</strong> takes its name from a medieval vivary ‚Äì a
            place where fish were kept as a food source. Over time, the area became
            a public park with lawns, ornamental gardens and water features. It‚Äôs
            now one of the town‚Äôs most loved green spaces.
          </p>
          <p>
            Lay out your food ‚Äì bread, cheese, deli treats, fruit, sweets and
            pastries ‚Äì and enjoy the contrast between the calm park and the busy
            streets you‚Äôve just explored.
          </p>
        </div>
        <p style="margin-top:1.1rem;font-size:0.9rem;color:var(--muted);">
          You can replay any stop by refreshing the page and working through the
          puzzles again, or simply explore Taunton further on your own route.
        </p>
      </div>
    </section>

    <footer>
      Distances and directions are approximate ‚Äì always use your judgment and stay
      safe when walking. This walk is designed as a playful companion, not a
      precise navigation tool.
    </footer>
  </main>

  <script>
    // --- DATA FOR EACH STOP ---------------------------------------------------
    const stops = [
      {
        id: 1,
        label: "Start ¬∑ Stop 1",
        name: "Castle Green & Taunton Castle (Starting Area)",
        distance: "Castle Green ‚Äì starting point",
        tags: ["History", "Castle", "Open space"],
        puzzleText:
          "Your journey begins where old stone walls watch over an open square. " +
          "Decode this Caesar-cipher phrase (shift every letter back by 3):",
        puzzleExtra:
          '<p><strong>Code:</strong> <code>Fdvwoh Fdvwoh Fdvwoh</code></p>' +
          "<p>This repeats the same word three times.</p>",
        hint:
          "In a Caesar cipher, each letter is shifted along the alphabet. Here, " +
          "you need to move each letter <em>back</em> by 3 (D‚ÜíA, E‚ÜíB, F‚ÜíC, etc.). " +
          "Try decoding just the first word.",
        acceptedAnswers: ["castle", "the castle"],
        answerExplanation:
          "Decoding the phrase by shifting each letter back by 3 gives you " +
          "<strong>CASTLE CASTLE CASTLE</strong>. That points you to the " +
          "<strong>castle and Castle Green</strong> ‚Äì your starting location.",
        historyHtml:
          "<p>Taunton Castle has medieval origins and by the 12th century " +
          "it was already a fortified site. Over its long life it has seen " +
          "sieges, political intrigue, and the dramatic events of the " +
          "<strong>Monmouth Rebellion</strong> in 1685, when James Scott " +
          "attempted to challenge King James II.</p>" +
          "<p>Castle Green in front of the castle is now a calm public space, " +
          "but for centuries it would have been surrounded by defensive works, " +
          "storehouses and people coming and going on official business.</p>",
        directionsHtml:
          "<p>Stand on <strong>Castle Green</strong> facing the castle. " +
          "When you‚Äôre ready to begin moving, walk down towards the " +
          "<strong>River Tone</strong> and look for paths leading along the riverside. " +
          "You‚Äôre heading towards quieter streets near St James Street for your next clue.</p>",
        picnicHtml:
          "<p>If there‚Äôs a market running on Castle Green, this is an excellent " +
          "place to pick up your first picnic items: fresh bread, pastries or " +
          "local snacks.</p>"
      },
      {
        id: 2,
        label: "Stop 2",
        name: "Towards Augustus Deli ¬∑ Riverside Flavours",
        distance: "Short walk from Castle Green (~3‚Äì5 min)",
        tags: ["Riverside", "Deli"],
        puzzleText:
          "From the castle, your path follows the river‚Äôs whisper. Solve this riddle " +
          "to find the <em>type</em> of place you‚Äôre seeking:",
        puzzleExtra:
          '<p><em>‚ÄúI hide behind glass in a quiet room.<br>' +
          "I serve slices and spreads, but I am not a kitchen.<br>" +
          "I‚Äôm cool, I‚Äôm savoury, and travellers take me away in little boxes.<br>" +
          'What am I?‚Äù</em></p>',
        hint:
          "Think of a counter full of olives, cheeses and sliced meats. It's not a supermarket aisle " +
          "and not a full restaurant table ‚Äì more a specialist counter or shop.",
        acceptedAnswers: ["deli", "delicatessen"],
        answerExplanation:
          "The riddle is describing a <strong>deli</strong> (delicatessen) ‚Äì " +
          "a place with cool counters of savoury treats ready to take away.",
        historyHtml:
          "<p>Streets near the river and St James Street have long been used as " +
          "routes for trade and travel in and out of Taunton. As the town grew, " +
          "small specialist food businesses began to cluster along these routes.</p>" +
          "<p>Modern delis continue that pattern, offering concentrated flavour " +
          "and a sense of continental food culture in a relatively small space.</p>",
        directionsHtml:
          "<p>From <strong>Castle Green</strong>, walk down towards the " +
          "<strong>River Tone</strong> and follow a path so that the river is on " +
          "one side of you. Look for streets leading towards " +
          "<strong>St James Street</strong>. In that general area, you‚Äôre looking " +
          "for a <strong>deli-style restaurant or counter</strong> (for example, Augustus Deli).</p>",
        picnicHtml:
          "<p>Pick up something flavourful but portable: olives, a small tub of " +
          "salad, cured meats or antipasti. These will go well with the bread " +
          "from earlier stops.</p>"
      },
      {
        id: 3,
        label: "Stop 3",
        name: "Cheese Connection ¬∑ Central Taunton",
        distance: "St James area ‚Üí main shopping streets (~3‚Äì5 min)",
        tags: ["Cheese", "Market heritage"],
        puzzleText:
          "Taunton‚Äôs story is closely tied to dairy. Unscramble this word to reveal " +
          "a key picnic ingredient and the theme of this stop:",
        puzzleExtra:
          '<p><strong>Scramble:</strong> <code>EESHC</code></p>',
        hint:
          "Try rearranging the letters into a common food that often comes in wedges " +
          "and goes well with bread. Start with the idea that it probably begins with CH...",
        acceptedAnswers: ["cheese"],
        answerExplanation:
          "Rearranging <code>EESHC</code> gives you <strong>CHEESE</strong>, " +
          "which is your clue for this stop.",
        historyHtml:
          "<p>Somerset is famous for its dairy farms, and markets in Taunton " +
          "would once have been busy with traders selling butter and " +
          "locally produced cheeses. These products were a vital source of " +
          "calories and could be stored longer than fresh milk.</p>" +
          "<p>Today, cheese counters, delis and specialist shops around the " +
          "town centre keep this tradition alive with both local and international varieties.</p>",
        directionsHtml:
          "<p>From the St James Street / riverside area, walk towards the " +
          "<strong>central shopping streets</strong> (for example, Fore Street and " +
          "the surrounding lanes). Look for a shop or counter selling " +
          "<strong>cheese</strong> ‚Äì this might be a specialist cheesemonger, " +
          "a deli with a cheese section, or a market stall if one is running.</p>",
        picnicHtml:
          "<p>Choose a single small wedge of cheese (local if possible) and some " +
          "crackers. Combined with your bread and deli items, you now have the " +
          "core of a classic picnic spread.</p>"
      },
      {
        id: 4,
        label: "Stop 4",
        name: "Ganesha Wholefoods ¬∑ Independent Spirit",
        distance: "Central streets ‚Üí smaller lanes (~3‚Äì5 min)",
        tags: ["Wholefoods", "Independent shop"],
        puzzleText:
          "This clue uses the <strong>Atbash cipher</strong>, which flips the alphabet " +
          "so A‚ÜîZ, B‚ÜîY, C‚ÜîX and so on. Decode this phrase:",
        puzzleExtra:
          '<p><strong>Code:</strong> <code>Tzm hrnvmw</code></p>' +
          "<p>It‚Äôs a stylised shortened form of the shop‚Äôs name.</p>",
        hint:
          "Write the alphabet A to Z, then Z to A underneath it. For each letter in " +
          "<code>TZM HRNVMW</code>, find its ‚Äòmirror‚Äô letter. Focus on the first " +
          "word ‚Äì it should turn into a name starting with G.",
        acceptedAnswers: ["ganesha", "ganesh"],
        answerExplanation:
          "Using Atbash (A‚ÜîZ, B‚ÜîY, C‚ÜîX‚Ä¶), <code>TZM</code> decodes to " +
          "<strong>GAN</strong>. The phrase is a shortened pointer to " +
          "<strong>Ganesha</strong>, as in Ganesha Wholefoods.",
        historyHtml:
          "<p>As Taunton expanded in the 18th and 19th centuries, many side streets " +
          "and lanes filled with small, independent businesses. These offered " +
          "specialist goods ‚Äì from groceries to textiles and remedies.</p>" +
          "<p>Modern independent wholefood shops continue that tradition, often " +
          "focusing on organic foods, ethical products and a more personal level " +
          "of service than big supermarkets.</p>",
        directionsHtml:
          "<p>From the busier main streets, work your way into the " +
          "<strong>smaller connecting lanes</strong> near the centre and the " +
          "St James area again. You‚Äôre looking for <strong>Ganesha Wholefoods</strong> " +
          "or a similar wholefoods shop nearby.</p>",
        picnicHtml:
          "<p>Pick up fruit, nuts, or a soft drink here. These will add freshness " +
          "and balance to your picnic ‚Äì something light alongside the bread, cheese " +
          "and savoury items you already have.</p>"
      },
      {
        id: 5,
        label: "Stop 5",
        name: "Mr. Miles Tea & Coffee House ¬∑ Stories & Steam",
        distance: "Wholefoods area ‚Üí main streets (~3‚Äì5 min)",
        tags: ["Tea & coffee", "Sweet treats"],
        puzzleText:
          "Hidden inside this sentence is the key word for your next stop. " +
          "Read the <strong>first letter of each word</strong>:",
        puzzleExtra:
          '<p><em>‚Äú<strong>C</strong>ream <strong>O</strong>ften <strong>F</strong>ills ' +
          '<strong>F</strong>ine <strong>E</strong>arthenware <strong>E</strong>agerly.‚Äù</em></p>',
        hint:
          "Take just the first letter of each word and write them in a row. " +
          "Think about a hot drink that appears in mugs and cups in many caf√©s.",
        acceptedAnswers: ["coffee"],
        answerExplanation:
          "The initial letters spell <strong>COFFEE</strong>: " +
          "Cream (C), Often (O), Fills (F), Fine (F), Earthenware (E), Eagerly (E). " +
          "This points you towards a tea & coffee house.",
        historyHtml:
          "<p>Tea and coffee houses became popular social spaces in Britain from the " +
          "17th century onwards, and by the Victorian era they were a key part of " +
          "urban life ‚Äì places to meet, talk, read and plan.</p>" +
          "<p>Independent tea & coffee houses in modern Taunton continue that role. " +
          "They‚Äôre somewhere between home and work where stories and ideas are shared " +
          "over hot drinks and sweet treats.</p>",
        directionsHtml:
          "<p>From the wholefoods area, walk back towards the " +
          "<strong>central high street</strong>. You‚Äôre looking for a " +
          "<strong>tea & coffee house</strong> such as Mr. Miles, in or near the " +
          "main shopping streets. Use local signage and your nose ‚Äì the smell of " +
          "roasting coffee is often a giveaway.</p>",
        picnicHtml:
          "<p>Consider picking up biscuits, a slice of cake or brownies that travel " +
          "well. You could also buy some loose-leaf tea or ground coffee to enjoy " +
          "later at home.</p>"
      },
      {
        id: 6,
        label: "Stop 6",
        name: "Bath Place ¬∑ Historic Lanes & Independents",
        distance: "High street ‚Üí Bath Place (~3‚Äì5 min)",
        tags: ["Historic lane", "Independent shops"],
        puzzleText:
          "This short number sequence hides the name of a historic lane. " +
          "Each number is a letter‚Äôs position in the alphabet (A=1, B=2, etc.):",
        puzzleExtra:
          '<p><strong>Code:</strong> <code>2-1-20-8</code></p>',
        hint:
          "Convert each number to a letter using A=1, B=2, C=3 and so on. " +
          "Then read them in order to get the word. Think of a lane name you " +
          "might have seen on signs nearby.",
        acceptedAnswers: ["bath"],
        answerExplanation:
          "2 = B, 1 = A, 20 = T, 8 = H. The code spells <strong>BATH</strong>, " +
          "pointing you to <strong>Bath Place</strong>, one of the most charming " +
          "historic lanes in Taunton.",
        historyHtml:
          "<p>Bath Place is a narrow historic lane lined with independent shops. " +
          "Its shape reflects medieval land plots ‚Äì long, thin strips of land " +
          "running back from the main street. Over time, buildings were squeezed " +
          "into these shapes, creating the slightly crooked, intimate character you " +
          "see today.</p>" +
          "<p>The lane has a mix of boutiques, caf√©s and specialist shops, and " +
          "gives a sense of how Taunton‚Äôs commercial heart developed over centuries.</p>",
        directionsHtml:
          "<p>From the main high street area, look for signs or maps pointing to " +
          "<strong>Bath Place</strong>. It‚Äôs a short walk from central shopping streets " +
          "and is usually recognisable as a narrower, older-looking lane with " +
          "independent shopfronts.</p>",
        picnicHtml:
          "<p>This is a nice place to pick up something a bit indulgent ‚Äì handmade " +
          "chocolates, sweets or a small special treat to finish off your picnic menu.</p>"
      },
      {
        id: 7,
        label: "Stop 7",
        name: "Artisan Bakery ¬∑ Final Food Stop",
        distance: "Bath Place ‚Üí nearby bakery (~3‚Äì5 min)",
        tags: ["Bakery", "Final food stop"],
        puzzleText:
          "Your last food-based puzzle is a riddle pointing to the kind of place " +
          "you‚Äôre seeking:",
        puzzleExtra:
          '<p><em>‚ÄúGolden at dawn, gone by noon,<br>' +
          "I live behind glass in a warm little room.<br>" +
          "Flour and fire make me rise,<br>" +
          "Find my makers and your picnic prize.‚Äù</em></p>",
        hint:
          "Think about what‚Äôs coming out of ovens early in the morning, and " +
          "what kind of shop sells warm loaves and pastries displayed behind glass.",
        acceptedAnswers: ["bakery", "baker"],
        answerExplanation:
          "The riddle describes a <strong>bakery</strong> ‚Äì warm, full of fresh " +
          "bread and pastries that often sell out quickly.",
        historyHtml:
          "<p>Bakers have been part of town life for many centuries. In some " +
          "periods, bread prices were regulated because it was such a vital staple. " +
          "Artisan bakeries continue that craft tradition, with early-morning starts " +
          "and loaves appearing before most people are awake.</p>",
        directionsHtml:
          "<p>From <strong>Bath Place</strong>, head towards nearby streets where " +
          "local shops and food businesses cluster. Look for an artisan bakery, " +
          "such as <strong>Hammett‚Äôs Bakery</strong>, with a window full of " +
          "freshly baked goods.</p>" +
          "<p>Once you‚Äôve picked up your final picnic item, it‚Äôs time to walk to " +
          "your picnic destination: <strong>Vivary Park</strong>. Head generally " +
          "south from the central streets, following signs to the park.</p>",
        picnicHtml:
          "<p>Choose a savoury pastry, pasty or sweet bun as your ‚Äògrand finale‚Äô " +
          "picnic item. You now have everything you need for a generous spread in the park.</p>"
      }
    ];

    let currentIndex = 0;
    let hasUnlockedThisStop = false;

    const introScreen = document.getElementById("intro-screen");
    const gameScreen = document.getElementById("game-screen");
    const finalScreen = document.getElementById("final-screen");

    const stageLabel = document.getElementById("stage-label");
    const stopNameEl = document.getElementById("stop-name");
    const stopDistanceEl = document.getElementById("stop-distance");
    const stopTagsEl = document.getElementById("stop-tags");

    const puzzleTextEl = document.getElementById("puzzle-text");
    const puzzleExtraEl = document.getElementById("puzzle-extra");
    const hintPanel = document.getElementById("hint-panel");
    const hintTextEl = document.getElementById("hint-text");
    const statusMsgEl = document.getElementById("status-msg");

    const answerInput = document.getElementById("answer-input");
    const answerExplanationEl = document.getElementById("answer-explanation");
    const historyTextEl = document.getElementById("history-text");
    const directionsTextEl = document.getElementById("directions-text");
    const picnicTextEl = document.getElementById("picnic-text");
    const resultPanel = document.getElementById("result-panel");

    const startBtn = document.getElementById("start-btn");
    const checkAnswerBtn = document.getElementById("check-answer-btn");
    const hintToggleBtn = document.getElementById("hint-toggle-btn");
    const giveUpBtn = document.getElementById("give-up-btn");
    const nextStopBtn = document.getElementById("next-stop-btn");

    function normaliseAnswer(str) {
      return (str || "")
        .toLowerCase()
        .trim()
        .replace(/[^a-z0-9 ]+/g, "")
        .replace(/\s+/g, " ");
    }

    function renderStop(index) {
      const stop = stops[index];
      hasUnlockedThisStop = false;

      stageLabel.textContent = stop.label;
      stopNameEl.textContent = stop.name;
      stopDistanceEl.textContent = stop.distance;

      if (stop.tags && stop.tags.length) {
        stopTagsEl.innerHTML = stop.tags
          .map((tag, i) => {
            const highlight = i === 0 ? "highlight" : "";
            return `<span class="tag ${highlight}">${tag}</span>`;
          })
          .join(" ");
      } else {
        stopTagsEl.textContent = "";
      }

      puzzleTextEl.innerHTML = stop.puzzleText;
      puzzleExtraEl.innerHTML = stop.puzzleExtra || "";
      hintTextEl.innerHTML = stop.hint || "";
      answerExplanationEl.innerHTML = "";
      historyTextEl.innerHTML = "";
      directionsTextEl.innerHTML = "";
      picnicTextEl.innerHTML = "";

      answerInput.value = "";
      statusMsgEl.textContent = "";
      statusMsgEl.className = "status";

      hintPanel.classList.add("hidden");
      hintToggleBtn.textContent = "üí° Show hint";

      resultPanel.classList.add("hidden");

      nextStopBtn.textContent =
        index === stops.length - 1 ? "üèÅ Go to final picnic screen" : "‚ûú Go to next puzzle";

      answerInput.focus();
    }

    function unlockStop(index, forcedReveal = false) {
      if (hasUnlockedThisStop) return;
      hasUnlockedThisStop = true;

      const stop = stops[index];
      answerExplanationEl.innerHTML = stop.answerExplanation;
      historyTextEl.innerHTML = stop.historyHtml;
      directionsTextEl.innerHTML = stop.directionsHtml;
      picnicTextEl.innerHTML = stop.picnicHtml;

      resultPanel.classList.remove("hidden");

      if (forcedReveal) {
        statusMsgEl.textContent =
          "Answer revealed. You can still follow the directions and continue the walk.";
        statusMsgEl.className = "status";
      } else {
        statusMsgEl.textContent = "Correct! Stop details unlocked.";
        statusMsgEl.className = "status ok";
      }
    }

    startBtn.addEventListener("click", () => {
      introScreen.classList.add("hidden");
      gameScreen.classList.remove("hidden");
      finalScreen.classList.add("hidden");
      currentIndex = 0;
      renderStop(currentIndex);
      window.scrollTo({ top: 0, behavior: "smooth" });
    });

    checkAnswerBtn.addEventListener("click", () => {
      const stop = stops[currentIndex];
      const userAnswer = normaliseAnswer(answerInput.value);
      if (!userAnswer) {
        statusMsgEl.textContent = "Type something first ‚Äì even a guess!";
        statusMsgEl.className = "status err";
        return;
      }

      const accepted = (stop.acceptedAnswers || []).some(a => {
        return normaliseAnswer(a) === userAnswer;
      });

      if (accepted) {
        unlockStop(currentIndex, false);
      } else {
        statusMsgEl.textContent = "Not quite. Try again or use the hint.";
        statusMsgEl.className = "status err";
      }
    });

    hintToggleBtn.addEventListener("click", () => {
      if (hintPanel.classList.contains("hidden")) {
        hintPanel.classList.remove("hidden");
        hintToggleBtn.textContent = "üí° Hide hint";
      } else {
        hintPanel.classList.add("hidden");
        hintToggleBtn.textContent = "üí° Show hint";
      }
    });

    giveUpBtn.addEventListener("click", () => {
      unlockStop(currentIndex, true);
    });

    nextStopBtn.addEventListener("click", () => {
      if (currentIndex < stops.length - 1) {
        currentIndex += 1;
        renderStop(currentIndex);
        window.scrollTo({ top: 0, behavior: "smooth" });
      } else {
        // Finished last stop ‚Üí show final picnic screen
        gameScreen.classList.add("hidden");
        finalScreen.classList.remove("hidden");
        window.scrollTo({ top: 0, behavior: "smooth" });
      }
    });
  </script>
</body>
</html>
